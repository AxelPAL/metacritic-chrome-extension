(function ($) {    let $searchField;    $(document).ready(function () {        $searchField = $('#search-field');        $(window).on('keydown', function (event) {            if (event.keyCode === 13) {                processEnteredRequest();                return false;            }        });        pasteSelection();        if ($searchField.val() === '') {            $searchField[0].focus();        }        $(document).on('click', '.page_num, .action, .bold', function (e){            e.preventDefault();            startProgress();            if ($(this).hasClass('bold')) {                $searchField.val($(this).text());            }            $('#result-box').html('');            loadSearchPage($(this).attr('href'));            $('html,body').animate({ scrollTop: 0 }, "slow");        });        $('#starter').on('click', function() {            processEnteredRequest();        });        firstRun();    });    function pasteSelection() {        chrome.tabs.query({active: true, currentWindow: true},            function (tab) {                chrome.tabs.sendMessage(tab[0].id, {method: "getSelection"},                    function (response) {                        if (response && response.data) {                            if ($searchField.is("*")) {                                $searchField.val(response.data);                            }                            if (response.data) {                                processEnteredRequest();                            }                        }                    });            });    }    function firstRun() {        if (typeof(localStorage.isFirstStart) == 'undefined') {            localStorage.isFirstStart = 0;            localStorage.video = true;            localStorage.game = true;        }    }    function processEnteredRequest() {        if ($searchField.val()) {            startProgress();            let link = encodeURIComponent($searchField.val());            link = link.replace(/%20/g, '+');            const endLink = 'http://www.metacritic.com/search/all/' + link + '/results';            loadSearchPage(endLink);        }    }    function loadSearchPage(url) {        $.ajax(url)            .done(function(d) {                parseMetacritic(d);            })            .fail(function() {                $('#result-box').html('Please, enter correct request');            })            .always(function() {                stopProgress();            });    }    function parseMetacritic(data) {        let res;        data = processMetacriticData(data);        res = $(data).find('.search_results');        $('#result-box').html(processSearchResults(res));    }    function processMetacriticData(data) {        return data.replaceAll('/images/icons/', 'https://metacritic.com/images/icons/');    }    function processSearchResults(results) {        $(results).find('a').each(function () {            if ($(this).attr('href').substr(0, 1) === '/') {                const link = 'https://metacritic.com' + $(this).attr('href');                $(this).attr('href', link);                if ($(this).parent().hasClass('product_title')) {                    $(this).attr('target', '_blank');                }            }        });        return results;    }    function startProgress() {        $('.progress').removeClass('hidden');    }    function stopProgress() {        $('.progress').addClass('hidden');    }})(jQuery);