$(function () {    $(document).ready(function () {        pasteSelection();        if (document.getElementById('searchfield')) {            document.getElementById('searchfield').focus();        }        firstRun();    });});function pasteSelection() {    chrome.tabs.query({active: true, currentWindow: true},        function (tab) {            chrome.tabs.sendMessage(tab[0].id, {method: "getSelection"},                function (response) {                    if (response && response.data) {                        if ($('#searchfield').is("*")) {                            $('#searchfield').val(response.data);                        }                        if (response.data) $('#starter').click();                    }                });        });}function firstRun() {    if (typeof(localStorage.isFirstStart) == 'undefined') {        localStorage.isFirstStart = 0;        localStorage.video = true;        localStorage.game = true;    }}$(document).ready(function () {    $(window).on('keydown', function (event) {        if (event.keyCode == 13) {            document.getElementById('starter').click();            return false;        }    });});(function ($) {    function ajaxStart() {        $('#progress').show();    }    function ajaxStop() {        $('#progress').hide();    }    function parserGo() {        if ($('#searchfield').val()) {            ajaxStart();            var link = encodeURIComponent($('#searchfield').val());            link = link.replace(/%20/g, '+');            var end_link = 'http://www.metacritic.com/search/all/' + link + '/results';            var b = $.ajax(end_link);            b.success(function (d) {                analysisSite(d);                ajaxStop();            });            b.fail(function (e, g, f) {                $('#resultbox').html('Please, enter correct request');                ajaxStop();            })        }    }    function analysisSite(data) {        var res = '';        var type = '';        var platform = '';        var score = 0;        res = '<table><thead><tr><th>Type</th><th>Platform</th><th>Name</th><th>Score</th></tr></thead><tbody>';        $(data).find('li.result').each(function () {            type = $(this).find('div.result_type').find('strong').text();            platform = $(this).find('span.platform').text();            if (!localStorage.video && type == 'Movie') return true;            if (!localStorage.game && platform) return true;            if (!localStorage.trailer && type == 'Trailer') return true;            if (!localStorage.music && type == 'Album') return true;            if (!localStorage.company && type == 'Company') return true;            if (!localStorage.people && type == 'People') return true;            if (!localStorage.tv && type == 'TV Show') return true;            if (!localStorage.tv && type == 'Feature') return true;            res += '<tr><td>';            if (type) {                res += '<img title=' + type + ' src="images/' + type.toLowerCase() + '.png" />';            }            res += '</td><td>';            if (platform) {                res += '<img title=' + platform + ' src="images/' + platform.toLowerCase() + '.png" />';            }            res += '</td><td class="name">';            res += '<a href="http://www.metacritic.com' + $(this).find('div.result_wrap').find('h3.product_title').find('a').attr('href') + '" target="_blank">' + $(this).find('div.result_wrap').find('h3.product_title').text() + '</a>' + ' ';            res += '</td>';            res += '<td> <div class="rate ';            score = $(this).find('div.result_wrap').find('span.metascore_w').text();            if (!score) {                score = $(this).find('span.textscore').text();                if (score < 40 && score > 0) res += 'score_red';                else if (score >= 40 && score <= 60) res += 'score_orange';                else if (score > 60) res += 'score_green';            }            else {                if (score < 50 && score > 0) res += 'score_red';                else if (score >= 50 && score < 75) res += 'score_orange';                else if (score >= 75) res += 'score_green';            }            res += '">';            if (!isNaN(score)) res += score;            res += '</div></td></tr>';        });        res += '</tbody></table>';        var result = res.match(/\d+/);        $('#resultbox').html(res);    }    $(function () {        $('#progress').hide();        $('#starter').click(parserGo);    });})(jQuery);